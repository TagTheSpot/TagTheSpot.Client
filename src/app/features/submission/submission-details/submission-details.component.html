<div class="xl:w-9/12 ml-auto mr-auto bg-white shadow-md rounded-2xl md:px-20 md:py-14 sm:px-14 sm:py-8 px-8 py-8">
    @if (submission) {
        <div class="w-full h-[300px] sm:h-[400px] md:h-[500px] lg:h-[600px] overflow-hidden rounded-xl">
            <swiper-container
            slides-per-view="1"
            zoom="true"
            pagination
            navigation
            class="w-full h-full cursor-pointer"
            [zoom]="{ maxRatio: 5 }"
            >
            @for (imageUrl of submission.imagesUrls; track $index) {
                <swiper-slide>
                    <div class="swiper-zoom-container w-full h-full">
                        <img [src]="imageUrl" class="w-full h-full object-contain" draggable="false" />
                    </div>
                </swiper-slide>
            }
            </swiper-container>
        </div>

        <h1 class="text-xl font-medium mt-7">
            @if (submission.spotType) {
                Стріт
            } @else if (submission.spotType == 'Park') {
                Парк
            } @else {
                Дьорт
            }
        </h1>
        <p class="mt-3">{{ submission.description }}</p>
        <div class="my-6">
            <app-spot-badges [item]="submission"></app-spot-badges>
        </div>
        <h2 class="text-xl font-medium mb-5">Де знайти?</h2>
        <div class="h-[300px] sm:h-[500px] min-w-full lg:min-w-[500px]">
        <div class="h-full overflow-hidden">
            <app-clickable-map 
                [markerPosition]="{ lat: submission.latitude, lon : submission.longitude }"
                [allowMarkerSet]="false"
                [zoom]="15">
            </app-clickable-map>
        </div>
        </div>
        <div class="w-full text-end mt-3">
            <a
                href="https://www.google.com/maps?q={{submission.latitude}},{{submission.longitude}}"
                target="_blank"
                class="hover:underline text-gray-500 text-md md:text-lg">
                Відкрити в Google Maps
            </a>
        </div>

        @if (submission.submissionStatus == 'Rejected') {
            @if (submission.rejectionReason) {
                <h2 class="text-lg text-red-500 mt-4">Відмовлено по причині:</h2>
                <div class="border border-red-500 h-fit px-5 py-3 font-medium mt-3 mb-4">
                    {{submission.rejectionReason}}
                </div>
            } @else {
                <h2 class="text-lg text-red-500 mt-4">Відмовлено без причини :(</h2>
            }
        }

        @if (authService.hasAdminRights() && submission.submissionStatus == 'Pending') {
            <div class="mt-4">
                @if (!isRejecting) {
                    <div class="flex flex-wrap gap-4">
                        <button 
                            class="border border-green-700 bg-green-100 text-green-800 hover:bg-green-200 hover:cursor-pointer font-medium px-5 py-2 shadow"
                            (click)="approveSubmission()">
                            Підтвердити
                        </button>

                        <button 
                            class="border border-red-700 bg-red-100 text-red-800 hover:bg-red-200 hover:cursor-pointer font-medium px-5 py-2 shadow"
                            (click)="toggleRejecting()">
                            Відхилити
                        </button>
                    </div>
                }
                @if (isRejecting) {
                    @let rejectionReason = form.controls['rejectionReason'];

                    <form [formGroup]="form" class="flex flex-col mt-4">
                        <label class="text-lg" for="rejectionReason">
                            Вкажи причину відмови
                            <span class="text-red-600 text-lg">*</span>
                        </label>
                        <textarea
                            class="border border-red-400 px-4 py-3 mt-1.5 placeholder-gray-400 h-24"
                            name="rejectionReason"
                            id="rejectionReason"
                            formControlName="rejectionReason"
                            placeholder="Опиши причину відмови.."
                            minlength="5"
                            maxlength="500"
                        ></textarea>

                        @if (rejectionReason.touched && rejectionReason.invalid) {
                            <ul class="errors-list mt-2">
                                @if (rejectionReason.errors?.['required']) {
                                    <li class="error-message text-red-600">Причина відмови обов'язкова.</li>
                                }
                                @if (rejectionReason.errors?.['minlength']) {
                                    <li class="error-message text-red-600">Довжина повинна бути щонайменше 5 символів.</li>
                                }
                                @if (rejectionReason.errors?.['maxlength']) {
                                    <li class="error-message text-red-600">Довжина не повинна перевищувати 500 символів.</li>
                                }
                            </ul>
                        }

                        <div class="flex gap-4 mt-4">
                            <button 
                                type="button"
                                class="border border-red-700 bg-red-100 text-red-800 hover:bg-red-200 font-medium px-5 py-2 shadow"
                                (click)="submitRejection()">
                                Відправити відмову
                            </button>
                            <button 
                                type="button"
                                class="border border-gray-400 bg-gray-100 text-gray-800 hover:bg-gray-200 font-medium px-5 py-2 shadow"
                                (click)="toggleRejecting()">
                                Скасувати
                            </button>
                        </div>
                    </form>
                }

                @if (errorMessage) {
                    <p class="text-lg text-red-500 mt-4">{{ errorMessage }}</p>
                }
            </div>
        }
        
        <div class="w-full text-end mt-5 flex items-center justify-end text-gray-500 text-md">
            <span class="material-symbols-outlined text-lg">schedule</span>
            <p class="ml-1 text-left">
                Створено {{ submission.submittedAt | date:'H:mm dd.MM.yyyy' }}
            </p>
        </div>
    }
</div>