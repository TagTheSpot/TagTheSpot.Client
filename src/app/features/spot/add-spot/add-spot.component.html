<div class="relative flex flex-col min-h-screen lg:py-6 lg:px-24">
  <div [class.blur-sm]="loading" class="flex-1 transition-all duration-200">
    <div class="flex items-center lg:mb-3 p-3 justify-center lg:justify-start">
      <a
        routerLink="/"
        class="material-symbols-outlined font-normal text-3xl lg:text-4xl pt-1"
        >keyboard_return</a
      >
      @if (cityData) {
        <h2 class="text-2xl lg:text-3xl font-normal ml-3">{{ cityData.name }}, –£–∫—Ä–∞—ó–Ω–∞</h2>
      }
    </div>
    <div class="bg-white rounded-2xl flex box-border shadow flex-wrap">
      <div class="flex-1 min-w-full lg:min-w-[550px]">
        <div class="px-6 py-4 md:px-16 md:py-10">
          <h1 class="text-3xl font-semibold">–î–æ–¥–∞–π –Ω–æ–≤–∏–π —Å–ø–æ—Ç!</h1>
          <p class="text-gray-600 text-lg">–ù–µ –∑–∞–±—É–¥—å –ø–æ—Å—Ç–∞–≤–∏—Ç–∏ –º–∞—Ä–∫–µ—Ä –Ω–∞ –º–∞–ø—ñ</p>
          <form
            class="flex flex-col my-3"
            (ngSubmit)="onSubmit()"
            [formGroup]="form"
          >
            @let type = form.controls['type']; 
            @let description = form.controls['description'];

            <label class="text-lg" for="spotType"
              >–û–±–µ—Ä–∏ —Ç–∏–ø —Å–ø–æ—Ç—É <span class="text-red-600 text-lg">*</span></label
            >
            <select
              class="border border-gray-300 px-3 py-1.5 mt-1.5 hover:ring-2 hover:ring-blue-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200"
              id="spotType"
              name="spotType"
              formControlName="type"
              required
            >
              <option value="" disabled>–û–±–µ—Ä–∏ —Ç–∏–ø —Å–ø–æ—Ç—É</option>
              <option value="Street">–°—Ç—Ä—ñ—Ç</option>
              <option value="Park">–ü–∞—Ä–∫</option>
              <option value="Dirt">–î—å–æ—Ä—Ç</option>
            </select>

            @if (type.touched && type.invalid) {
            <ul class="errors-list mt-2">
              @if (type.errors?.['required']) {
              <li class="error-message text-red-600">–¢–∏–ø —Å–ø–æ—Ç—É –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π.</li>
              }
            </ul>
            }

            <label class="text-lg mt-2" for="description"
              >–û–ø–∏—à–∏ —Å–ø–æ—Ç —Å–≤–æ—ó–º–∏ —Å–ª–æ–≤–∞–º–∏
              <span class="text-red-600 text-lg">*</span></label
            >
            <textarea
              class="border border-gray-300 px-4 py-1.5 mt-1.5 hover:ring-2 hover:ring-blue-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-colors duration-200 resize-y placeholder-gray-400 h-24"
              name="description"
              id="description"
              formControlName="description"
              placeholder="–ö–æ—Ä–æ—Ç–∫–æ –æ–ø–∏—à–∏ —Å–ø–æ—Ç.."
              minlength="10"
              maxlength="1000"
            ></textarea>

            @if (description.touched && description.invalid) {
            <ul class="errors-list mt-2">
              @if (description.errors?.['required']) {
              <li class="error-message text-red-600">–û–ø–∏—Å —Å–ø–æ—Ç—É –æ–±–æ–≤'—è–∑–∫–æ–≤–∏–π.</li>
              } @if (!description.errors?.['required'] &&
              description.errors?.['minlength']) {
              <li class="error-message text-red-600">
                –î–æ–≤–∂–∏–Ω–∞ –æ–ø–∏—Å—É –º–∞—î –±—É—Ç–∏ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 10 —Å–∏–º–≤–æ–ª—ñ–≤.
              </li>
              } @if (description.errors?.['maxlength']) {
              <li class="error-message text-red-600">
                –î–æ–≤–∂–∏–Ω–∞ –æ–ø–∏—Å—É –Ω–µ –º–∞—î –ø–µ—Ä–µ–≤–∏—â—É–≤–∞—Ç–∏ 1000 —Å–∏–º–≤–æ–ª—ñ–≤.
              </li>
              }
            </ul>
            }

            <div class="flex items-center mt-3 flex-wrap gap-x-4 gap-y-2">
              <label class="text-lg"
                >–ó–∞–≤–∞–Ω—Ç–∞–∂ —Ö–æ—á–∞ –± –æ–¥–Ω–µ —Ñ–æ—Ç–æ (.jpg, .jpeg, .png, .webp)
                <span class="text-red-600 text-lg">*</span></label
              >

              <input
                id="fileInput"
                type="file"
                class="hidden"
                accept=".jpg,.jpeg,.png,.webp"
                multiple
                (change)="onFilesSelected($event)"
              />

              <label
                for="fileInput"
                class="cursor-pointer border border-gray-300 bg-white hover:bg-blue-50 hover:ring-2 hover:ring-blue-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-colors duration-200 text-gray-700 px-8 py-1"
              >
                –û–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª–∏
              </label>
            </div>

            <ul class="mt-1 text-gray-600 list-inside">
              @for (file of files; track $index) {
              <li>{{ file.name }}</li>
              }
            </ul>

            @if (imageErrors) {
              <ul class="mt-1 text-red-600 list-inside sm:text-base">
                @for (error of imageErrors; track $index) {
                  <li class="break-words">{{ error }}</li>
                }
              </ul>
            }

            <div class="flex flex-wrap gap-x-4 gap-y-1 mt-3">
              <div class="flex items-center">
                <label for="isCovered" class="text-lg"> –ß–∏ –∫—Ä–∏—Ç–∏–π? </label>
                <input
                  type="checkbox"
                  name="isCovered"
                  id="isCovered"
                  class="appearance-none w-5 h-5 ml-3 border border-gray-300 rounded checked:bg-blue-500 checked:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 flex-shrink-0"
                  formControlName="isCovered"
                />
              </div>

              <div class="flex items-center">
                <label for="lighting" class="text-lg"> –ß–∏ —î –æ—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è? </label>
                <input
                  type="checkbox"
                  name="lighting"
                  id="lighting"
                  class="appearance-none w-5 h-5 ml-3 border border-gray-300 rounded checked:bg-blue-500 checked:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 flex-shrink-0"
                  formControlName="lighting"
                />
              </div>
            </div>

            <label class="text-lg mt-4" for="skillLevel"
              >–û–±–µ—Ä–∏ —Ä—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ</label
            >
            <select
              class="border border-gray-300 px-3 py-1.5 mt-1.5 hover:ring-2 hover:ring-blue-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200"
              id="skillLevel"
              name="skillLevel"
              formControlName="skillLevel"
            >
              <option [ngValue]="null">–û–±–µ—Ä–∏ —Ä—ñ–≤–µ–Ω—å —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ</option>
              <option value="Beginner">–ü–æ—á–∞—Ç–∫—ñ–≤–µ—Ü—å</option>
              <option value="Intermediate">–°–µ—Ä–µ–¥–Ω—ñ–π</option>
              <option value="Advanced">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∏–π</option>
            </select>

            <label class="text-lg mt-3" for="skillLevel"
              >–û–±–µ—Ä–∏ —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ</label
            >
            <select
              class="border border-gray-300 px-3 py-1.5 mt-1.5 hover:ring-2 hover:ring-blue-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200"
              id="accessibility"
              name="accessibility"
              formControlName="accessibility"
            >
              <option [ngValue]="null">–û–±–µ—Ä–∏ —Ä—ñ–≤–µ–Ω—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ</option>
              <option value="Public">–ü—É–±–ª—ñ—á–Ω–∏–π</option>
              <option value="Private">–ü—Ä–∏–≤–∞—Ç–Ω–∏–π</option>
              <option value="DIY">DIY</option>
              <option value="Chargeable">–ü–ª–∞—Ç–Ω–∏–π</option>
              <option value="Unknown">–ù–µ–≤—ñ–¥–æ–º–æ</option>
            </select>

            <label class="text-lg mt-3" for="skillLevel">–û–±–µ—Ä–∏ —Å—Ç–∞–Ω</label>
            <select
              class="border border-gray-300 px-3 py-1.5 mt-1.5 hover:ring-2 hover:ring-blue-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition-all duration-200"
              id="condition"
              name="condition"
              formControlName="condition"
            >
              <option [ngValue]="null">–û–±–µ—Ä–∏ —Å—Ç–∞–Ω</option>
              <option value="Good">–•–æ—Ä–æ—à–∏–π</option>
              <option value="Damaged">–ü–æ—à–∫–æ–¥–∂–µ–Ω–∏–π</option>
              <option value="NeedsRepair">–ü–æ—Ç—Ä–µ–±—É—î —Ä–µ–º–æ–Ω—Ç—É</option>
              <option value="NotRideable">–ù–µ–∫–∞—Ç–∞–±–µ–ª—å–Ω–∏–π</option>
            </select>

            @if (errorMessage) {
              <span class="error-message text-lg text-red-600 mt-3">{{ errorMessage }}</span>
            }

            <button
              class="mt-7 sm:mt-9 bg-blue-600 text-white h-14 text-lg hover:bg-blue-700 hover:shadow-md transition-colors duration-200 cursor-pointer"
              type="submit"
            >
              –î–æ–¥–∞—Ç–∏
            </button>
          </form>
        </div>
      </div>
      <div class="flex-1 min-h-[500px] min-w-full lg:min-w-[500px]">
        <div class="h-full overflow-hidden xl:rounded-r-2xl relative">
          <app-clickable-map
            [preloadedMarkerPositions]="spotsMarkers"
            [center]="mapCenter"
            [userMarkerPosition]="userMarkerPosition"
            [zoom]="mapZoom"
            (coordinates)="onCoordinatesSelected($event)">
          </app-clickable-map>

          <button 
            (click)="locateMe()"
            class="absolute top-4 right-4 w-10 h-10 flex items-center justify-center 
                  bg-white rounded-full shadow-lg border border-gray-200 
                  hover:bg-blue-50 hover:ring-2 hover:ring-blue-400 transition-all hover:cursor-pointer duration-200">
            <span class="text-lg">üìç</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  @if (loading) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm pointer-events-auto">
      <div class="flex justify-center items-center space-x-2">
        <div class="w-4 h-4 bg-white animate-bounce" style="animation-delay: 0s;"></div>
        <div class="w-4 h-4 bg-white animate-bounce" style="animation-delay: 0.2s;"></div>
        <div class="w-4 h-4 bg-white animate-bounce" style="animation-delay: 0.4s;"></div>
      </div>
    </div>
  }
</div>